{"version":3,"file":"Article.controller-9f6d2af7.js","sources":["../../../.svelte-kit/adapter-node/chunks/Article.controller.js"],"sourcesContent":["import { A as Article, U as User } from \"./User.js\";\nimport { U as UserController } from \"./User.controller.js\";\nimport { P as PUBLIC_SERVICE_URL } from \"./public.js\";\nconst ArticleController = {\n  async get(options) {\n    const isInvalidArrayOption = (option) => (option?.join(\"\").length ?? 0) === 0;\n    const articleDocs = await Article.find({\n      ...isInvalidArrayOption(options.contentTags) ? {} : { contentTags: { $in: options.contentTags } },\n      ...isInvalidArrayOption(options.authors) ? {} : { authorId: { $in: options.authors } },\n      ...isInvalidArrayOption(options.states) ? {} : { state: { $in: options.states } },\n      ...options.includeInternal ? {} : { scope: \"PUBLIC\" }\n    });\n    const articles = await Promise.all(articleDocs.map(ArticleController.refineArticle));\n    return articles;\n  },\n  async read(_id, includeInternal, fingerPrint) {\n    const article = await Article.findOne(includeInternal ? { _id, state: \"PUBLISHED\" } : { _id, state: \"PUBLISHED\", scope: \"PUBLIC\" });\n    return await ArticleController.refineArticle(article);\n  },\n  async submitArticleForReview(articleBody) {\n    const fullArticleBody = {\n      ...articleBody,\n      state: [\"PENDING\"],\n      submittedDate: Date.now(),\n      publisherId: null,\n      publishedDate: null\n    };\n    const article = new Article(fullArticleBody);\n    article.url = PUBLIC_SERVICE_URL + \"/articles/\" + article._id;\n    await article.save();\n  },\n  async publishArticle(articleId, publisherId) {\n    await Article.updateOne(\n      { _id: articleId },\n      {\n        publishedDate: Date.now(),\n        publisherId,\n        state: [\"PUBLISHED\"]\n      }\n    );\n  },\n  async rejectArticle(articleId, publisherId) {\n    await Article.updateOne(\n      { _id: articleId },\n      {\n        state: [\"REJECTED\"]\n      }\n    );\n  },\n  async refineArticle(rawArticle) {\n    if (rawArticle == null)\n      return null;\n    const {\n      _id,\n      scope,\n      state,\n      coverImgSrc,\n      title,\n      description,\n      markdownText,\n      contentTags,\n      submittedDate,\n      publishedDate,\n      url\n    } = rawArticle;\n    const author = await ArticleController.resolveAuthor(rawArticle);\n    const article = {\n      id: _id,\n      scope,\n      state,\n      coverImgSrc,\n      title,\n      description,\n      markdownText,\n      contentTags,\n      submittedDate,\n      publishedDate,\n      url,\n      author\n    };\n    return article;\n  },\n  async resolveAuthor(article) {\n    const authorDoc = await User.findOne({ email: article.authorId });\n    if (authorDoc == null)\n      return null;\n    const articleInfo = await UserController.getArticleInfo(authorDoc.email);\n    const { name, email, image, permissions } = authorDoc;\n    const author = {\n      name,\n      email,\n      image,\n      permissions,\n      articleInfo\n    };\n    return author;\n  }\n};\nexport {\n  ArticleController as A\n};\n"],"names":[],"mappings":"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"}