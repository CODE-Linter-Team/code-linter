{"version":3,"file":"_server.ts-0f7732f8.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/me/_server.ts.js"],"sourcesContent":["import { U as UserController } from \"../../../../chunks/User.controller.js\";\nimport { P as Permission } from \"../../../../chunks/permissions.js\";\nimport { c as connectToDatabase } from \"../../../../chunks/connectToDatabase.js\";\nimport { U as User } from \"../../../../chunks/User.js\";\nasync function GET({ locals }) {\n  const DEFAULT_PERMISSIONS = [Permission.SUBMIT_ARTICLES_FOR_REVIEW.id];\n  await connectToDatabase();\n  const { user } = await locals.getSession() ?? {};\n  if (user == null) {\n    return new Response(\n      JSON.stringify({\n        isSignedIn: false,\n        wasJustCreated: false,\n        me: null\n      }),\n      { headers: { \"Content-Type\": \"application/json\" } }\n    );\n  }\n  const userDoc = await User.findOne({ email: user?.email });\n  if (userDoc == null) {\n    const newUser = new User({\n      ...user,\n      permissions: DEFAULT_PERMISSIONS\n    });\n    await newUser.save();\n    const { permissions: permissions2, name: name2, email: email2, image: image2 } = newUser;\n    const articleInfo2 = await UserController.getArticleInfo(email2);\n    const me2 = { permissions: permissions2, name: name2, email: email2, image: image2, articleInfo: articleInfo2 };\n    return new Response(JSON.stringify({ isSignedIn: true, wasJustCreated: true, me: me2 }), {\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n  const { permissions, name, email, image } = userDoc;\n  const articleInfo = await UserController.getArticleInfo(email);\n  const me = { permissions, name, email, image, articleInfo };\n  return new Response(JSON.stringify({ isSignedIn: true, wasJustCreated: false, me }), {\n    headers: { \"Content-Type\": \"application/json\" }\n  });\n}\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;;;AAIA,eAAe,GAAG,CAAC,EAAE,MAAM,EAAE,EAAE;AAC/B,EAAE,MAAM,mBAAmB,GAAG,CAAC,UAAU,CAAC,0BAA0B,CAAC,EAAE,CAAC,CAAC;AACzE,EAAE,MAAM,iBAAiB,EAAE,CAAC;AAC5B,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,MAAM,CAAC,UAAU,EAAE,IAAI,EAAE,CAAC;AACnD,EAAE,IAAI,IAAI,IAAI,IAAI,EAAE;AACpB,IAAI,OAAO,IAAI,QAAQ;AACvB,MAAM,IAAI,CAAC,SAAS,CAAC;AACrB,QAAQ,UAAU,EAAE,KAAK;AACzB,QAAQ,cAAc,EAAE,KAAK;AAC7B,QAAQ,EAAE,EAAE,IAAI;AAChB,OAAO,CAAC;AACR,MAAM,EAAE,OAAO,EAAE,EAAE,cAAc,EAAE,kBAAkB,EAAE,EAAE;AACzD,KAAK,CAAC;AACN,GAAG;AACH,EAAE,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC;AAC7D,EAAE,IAAI,OAAO,IAAI,IAAI,EAAE;AACvB,IAAI,MAAM,OAAO,GAAG,IAAI,IAAI,CAAC;AAC7B,MAAM,GAAG,IAAI;AACb,MAAM,WAAW,EAAE,mBAAmB;AACtC,KAAK,CAAC,CAAC;AACP,IAAI,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;AACzB,IAAI,MAAM,EAAE,WAAW,EAAE,YAAY,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,OAAO,CAAC;AAC7F,IAAI,MAAM,YAAY,GAAG,MAAM,cAAc,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;AACrE,IAAI,MAAM,GAAG,GAAG,EAAE,WAAW,EAAE,YAAY,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,WAAW,EAAE,YAAY,EAAE,CAAC;AACpH,IAAI,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,UAAU,EAAE,IAAI,EAAE,cAAc,EAAE,IAAI,EAAE,EAAE,EAAE,GAAG,EAAE,CAAC,EAAE;AAC7F,MAAM,OAAO,EAAE,EAAE,cAAc,EAAE,kBAAkB,EAAE;AACrD,KAAK,CAAC,CAAC;AACP,GAAG;AACH,EAAE,MAAM,EAAE,WAAW,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,OAAO,CAAC;AACtD,EAAE,MAAM,WAAW,GAAG,MAAM,cAAc,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;AACjE,EAAE,MAAM,EAAE,GAAG,EAAE,WAAW,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,WAAW,EAAE,CAAC;AAC9D,EAAE,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,UAAU,EAAE,IAAI,EAAE,cAAc,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,EAAE;AACvF,IAAI,OAAO,EAAE,EAAE,cAAc,EAAE,kBAAkB,EAAE;AACnD,GAAG,CAAC,CAAC;AACL;;;;"}