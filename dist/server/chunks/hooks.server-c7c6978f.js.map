{"version":3,"file":"hooks.server-c7c6978f.js","sources":["../../../.svelte-kit/adapter-node/chunks/environment.js","../../../.svelte-kit/adapter-node/chunks/hooks.server.js"],"sourcesContent":["import { D as DEV } from \"./prod-ssr.js\";\nconst dev = DEV;\nexport {\n  dev as d\n};\n","import { d as dev } from \"./environment.js\";\nimport { e as env } from \"./index.js\";\nimport { A as AUTH_SECRET, S as SECRET_GOOGLE_ID, a as SECRET_GOOGLE_SECRET, b as SECRET_SERVICE_AUTH_SECRET, c as connectToDatabase } from \"./connectToDatabase.js\";\nimport { AuthHandler } from \"@auth/core\";\nimport Google from \"@auth/core/providers/google\";\nimport { U as User, A as Article } from \"./User.js\";\nimport { P as Permission } from \"./permissions.js\";\nimport { P as PUBLIC_SERVICE_URL } from \"./public.js\";\nasync function getSession(req, options) {\n  options.secret ??= AUTH_SECRET;\n  options.trustHost ??= true;\n  const url = new URL(\"/api/auth/session\", req.url);\n  const response = await AuthHandler(new Request(url, { headers: req.headers }), options);\n  const { status = 200 } = response;\n  const data = await response.json();\n  if (!data || !Object.keys(data).length)\n    return null;\n  if (status === 200)\n    return data;\n  throw new Error(data.message);\n}\nconst actions = [\n  \"providers\",\n  \"session\",\n  \"csrf\",\n  \"signin\",\n  \"signout\",\n  \"callback\",\n  \"verify-request\",\n  \"error\",\n  \"_log\"\n];\nfunction SvelteKitAuthHandler(prefix, authOptions) {\n  return ({ event, resolve }) => {\n    const { url, request } = event;\n    event.locals.getSession ??= () => getSession(request, authOptions);\n    const [action] = url.pathname.slice(prefix.length + 1).split(\"/\");\n    if (actions.includes(action) && url.pathname.startsWith(prefix + \"/\")) {\n      return AuthHandler(request, authOptions);\n    }\n    return resolve(event);\n  };\n}\nfunction SvelteKitAuth(options) {\n  const { prefix = \"/auth\", ...authOptions } = options;\n  authOptions.secret ??= AUTH_SECRET;\n  authOptions.trustHost ??= !!(env.AUTH_TRUST_HOST ?? env.VERCEL ?? dev);\n  return SvelteKitAuthHandler(prefix, authOptions);\n}\nconst handle = SvelteKitAuth({\n  providers: [Google({ clientId: SECRET_GOOGLE_ID, clientSecret: SECRET_GOOGLE_SECRET })],\n  secret: SECRET_SERVICE_AUTH_SECRET\n});\nasync function seedDatabase() {\n  await User.deleteMany();\n  await Article.deleteMany();\n  const ALL_PERMISSIONS = Object.keys(Permission);\n  await connectToDatabase();\n  const linus = new User({\n    name: \"Linus Bolls\",\n    email: \"linus.bolls@code.berlin\",\n    image: \"https://lh3.googleusercontent.com/a/AEdFTp6PSy2Omni3BiexQvgjuZwIoUsnujabr6eVZvC0=s96-c\",\n    permissions: ALL_PERMISSIONS\n  });\n  await linus.save();\n  const laurin = new User({\n    name: \"Laurin Notemann\",\n    email: \"laurin.notemann@code.berlin\",\n    image: \"https://lh3.googleusercontent.com/a/AEdFTp4DZtIehcTa3BXJ0Wh-ykeGj43bWgVeT3DB0UMO=s96-c\",\n    permissions: ALL_PERMISSIONS\n  });\n  await laurin.save();\n  const daniel = new User({\n    name: \"Daniel Azomji\",\n    email: \"daniel.azomji@code.berlin\",\n    image: \"https://lh3.googleusercontent.com/a-/AD5-WClbXchZjeOgyZG8IG8iojnarP5nvv18RJlHjHM3OAtlEdsFRX4SvQJWLUVJUeLn=s96-c\",\n    permissions: ALL_PERMISSIONS\n  });\n  await daniel.save();\n  const testArticle = new Article({\n    scope: \"PUBLIC\",\n    state: [\"PUBLISHED\"],\n    authorId: \"linus.bolls@code.berlin\",\n    publisherId: \"linus.bolls@code.berlin\",\n    coverImgSrc: \"https://cdn.pixabay.com/photo/2017/02/20/18/03/cat-2083492__340.jpg\",\n    title: `Ab wann sind Klimaaktivisten eine \"kriminelle Vereinigung\"?`,\n    description: 'Sie kleben sich an Straßen und Gemälde oder blockieren Rollfelder. Doch das sind nicht die Gründe für die bundesweite Razzia gegen einige Aktivisten der \"Letzten Generation\".',\n    contentTags: [\"Technology\"],\n    submittedDate: 0,\n    publishedDate: 0,\n    markdownText: `## 2021 Wrap-Up | Malik Piara\n\nWe are very excited to share today’s 2021 wrap-up which is dedicated to Malik Piara, #NextGeneration Product Management student.\n\nThis semester Malik decided to focus on philosophy and social psychology, believing product management and leading a company narrow down to decision-making. Malik is currently learning and absorbing everything from Aristotle and is working on the 5 Science, Technology, and Society (STS) modules. Malik’s free time is mostly spent writing on Moonwith. Moonwith is Malik’s blog about emotional intelligence and decision-making and building Earnest: cards for deeper conversations.\n\n## What are you doing next?\n\nI want to work on startup mentoring program anyone in Portugal can have access to, regardless of the city they live in, their connections or their income. I’m also currently planning ‘Fingerprint’, a conference for people who want to build the future. On my free time, I’ll keep honing software engineering skills and building new products every Sunday.\n\n## A moment I almost lost hope…\n\nHaving to close Upframe after 5 years of work and after already having moved to Lisbon and sold some of my things to keep the boat afloat was rock bottom. I couldn’t leave my bed for a week.\n\n## My biggest challenge this year/semester;\n\nKeeping my mental health in check and realising the startup life is not everything. It’s okay to take breaks. And there are other paths that can be equated with success. Overworking should not be glorified.\n\n## My greatest success…\n\nOne year ago I didn’t know Python, Flask or NoSQL. I had never built an app before. This year I worked on 4 apps and I launched a job board for startups in Portugal which is helping people every day. I’m so proud and I would not believe that would be possible if you told me. You can learn anything. I truly believe in that.\n\n## I’m proud of myself because… \n\nI’m proud to have taken steps towards improving myself and letting go of my unhealthy obsession with work. This included seeking a coach, a therapist and a personal trainer that are here to keep me balanced. I know most people cannot afford this and I feel incredibly fortunate.\n\n## People that really helped me this year…\n\nBen Bachem, Jonathan Freiberger, Moritz Eich, Hanno Grimm, Teodora Trposka, Johann Hemmann, Dennis Willmann and Lukas Müller kept me sane while I felt alone in Lisbon. And they helped accelerate my learning. That’s one of the things I love about CODE. I’m smiling thinking about how many people are there for me and with whom I can learn anything I want faster than I could ever before.\n`\n  });\n  testArticle.url = PUBLIC_SERVICE_URL + \"/articles/\" + testArticle._id;\n  await testArticle.save();\n}\nseedDatabase();\nexport {\n  handle\n};\n"],"names":[],"mappings":"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"}