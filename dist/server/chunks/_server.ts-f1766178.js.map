{"version":3,"file":"_server.ts-f1766178.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/assets/_server.ts.js"],"sourcesContent":["import { e as error } from \"../../../../chunks/index3.js\";\nimport { c as connectToDatabase } from \"../../../../chunks/connectToDatabase.js\";\nimport { a as AssetController } from \"../../../../chunks/Asset.controller.js\";\nimport { U as UserController } from \"../../../../chunks/User.controller.js\";\nimport { P as Permission } from \"../../../../chunks/permissions.js\";\nasync function POST({ locals, request }) {\n  await connectToDatabase();\n  const { user } = await locals.getSession() ?? {};\n  const isLoggedIn = user != null;\n  if (!isLoggedIn)\n    return new Response(\"{}\", { headers: { \"Content-Type\": \"application/json\" }, status: 401 });\n  const hasPermission = await UserController.hasPermissions(user.email, [\n    Permission.SUBMIT_ARTICLES_FOR_REVIEW.id\n  ]);\n  if (!hasPermission)\n    throw error(403, \"missing permission: 'SUBMIT_ARTICLES_FOR_REVIEW'\");\n  const formData = await request.formData();\n  const blobData = formData.get(\"data\");\n  const arrayBufferData = await blobData.arrayBuffer();\n  const data = Buffer.from(arrayBufferData);\n  const title = formData.get(\"title\");\n  const alt = formData.get(\"alt\");\n  const ownerId = user.email;\n  const asset = await AssetController.create({ data, title, alt }, ownerId);\n  return new Response(JSON.stringify(asset), {\n    headers: { \"Content-Type\": \"application/json\" },\n    status: 201\n  });\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":";;;;;;;;AAKA,eAAe,IAAI,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE;AACzC,EAAE,MAAM,iBAAiB,EAAE,CAAC;AAC5B,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,MAAM,CAAC,UAAU,EAAE,IAAI,EAAE,CAAC;AACnD,EAAE,MAAM,UAAU,GAAG,IAAI,IAAI,IAAI,CAAC;AAClC,EAAE,IAAI,CAAC,UAAU;AACjB,IAAI,OAAO,IAAI,QAAQ,CAAC,IAAI,EAAE,EAAE,OAAO,EAAE,EAAE,cAAc,EAAE,kBAAkB,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC;AAChG,EAAE,MAAM,aAAa,GAAG,MAAM,cAAc,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,EAAE;AACxE,IAAI,UAAU,CAAC,0BAA0B,CAAC,EAAE;AAC5C,GAAG,CAAC,CAAC;AACL,EAAE,IAAI,CAAC,aAAa;AACpB,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,kDAAkD,CAAC,CAAC;AACzE,EAAE,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,QAAQ,EAAE,CAAC;AAC5C,EAAE,MAAM,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AACxC,EAAE,MAAM,eAAe,GAAG,MAAM,QAAQ,CAAC,WAAW,EAAE,CAAC;AACvD,EAAE,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;AAC5C,EAAE,MAAM,KAAK,GAAG,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;AACtC,EAAE,MAAM,GAAG,GAAG,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AAClC,EAAE,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC;AAC7B,EAAE,MAAM,KAAK,GAAG,MAAM,eAAe,CAAC,MAAM,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,EAAE,EAAE,OAAO,CAAC,CAAC;AAC5E,EAAE,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE;AAC7C,IAAI,OAAO,EAAE,EAAE,cAAc,EAAE,kBAAkB,EAAE;AACnD,IAAI,MAAM,EAAE,GAAG;AACf,GAAG,CAAC,CAAC;AACL;;;;"}